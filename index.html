<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Recherche Schiettent: Code Actief</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --pol: #1d4e89; --bg: #020617; --gold: #ffd700; --danger: #ef4444; }
        body { font-family: 'Courier New', Courier, monospace; background: var(--bg); color: white; margin: 0; overflow: hidden; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; cursor: crosshair; }
        
        /* De vliegende zinnen */
        .target-sentence {
            position: absolute; white-space: nowrap; font-size: 1.5em; font-weight: bold;
            background: rgba(30, 41, 59, 0.8); padding: 10px 20px; border-radius: 5px;
            border: 1px solid var(--pol); user-select: none;
        }
        .v-deelwoord { color: var(--danger); cursor: pointer; padding: 0 5px; border: 1px dashed transparent; }
        .v-deelwoord:hover { border-color: var(--gold); background: rgba(255, 215, 0, 0.2); }

        /* Fase 2: Hertekst */
        #input-overlay {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--pol); padding: 30px; border: 4px solid var(--gold); border-radius: 15px;
            z-index: 100; width: 500px; text-align: center;
        }
        input { width: 100%; padding: 15px; font-size: 1.2em; margin: 15px 0; border: none; border-radius: 5px; }

        /* UI Elementen */
        #hud { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; font-size: 1.5em; z-index: 50; background: rgba(0,0,0,0.5); }
        .leaderboard { position: fixed; bottom: 20px; right: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div id="hud">
    <div>Agent: <span id="display-naam">...</span></div>
    <div>TIJD: <span id="timer">60</span>s</div>
    <div>SCORE: <span id="score">0</span></div>
</div>

<div id="game-container">
    <div id="start-screen" style="text-align: center; margin-top: 20vh;">
        <h1>RECHERCHE SCHIETTENT</h1>
        <p>Schiet op het voltooid deelwoord en schrijf de zin daarna actief.</p>
        <input type="text" id="speler-naam" placeholder="Achternaam..." style="width: 250px;"><br>
        <button onclick="startGame()" style="padding: 15px 40px; font-weight: bold; cursor: pointer;">START MISSIE</button>
    </div>
</div>

<div id="input-overlay">
    <p>Maak de zin actief (ik-vorm, verleden tijd):</p>
    <div id="target-phrase" style="font-style: italic; margin-bottom: 10px;"></div>
    <input type="text" id="active-input" placeholder="Typ de actieve zin...">
    <p style="font-size: 0.8em;">Tip: Gebruik geen 'worden' of 'zijn'!</p>
</div>

<div class="leaderboard">
    <strong>TOP 3 RECHERCHEURS:</strong>
    <ol id="leader-list"></ol>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBOo2LzR1IBnsiBR2SCwPJABtaRv0tpKQ4",
        authDomain: "speeltuin-recherche.firebaseapp.com",
        databaseURL: "https://speeltuin-recherche-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "speeltuin-recherche",
        appId: "1:499912834123:web:3c84cbf4d5eb13131961ce"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const data = [
        {pas: "De verdachte werd door mij <span class='v-deelwoord'>gezien</span>.", corr: "ik zag de verdachte"},
        {pas: "Het raam werd door hem <span class='v-deelwoord'>ingeslagen</span>.", corr: "ik zag dat hij het raam insloeg"}, // Uitdagend!
        {pas: "De achtervolging werd door ons <span class='v-deelwoord'>ingezet</span>.", corr: "ik zette de achtervolging in"},
        {pas: "Het voertuig werd door mij <span class='v-deelwoord'>gecontroleerd</span>.", corr: "ik controleerde het voertuig"},
        {pas: "De getuige werd door de agent <span class='v-deelwoord'>gehoord</span>.", corr: "ik hoorde de getuige"},
        {pas: "De tas werd door de vrouw <span class='v-deelwoord'>meegenomen</span>.", corr: "ik zag dat de vrouw de tas meenam"}
    ];

    let score = 0;
    let timeLeft = 60;
    let gameActive = false;
    let huidigeOpgave = null;

    function startGame() {
        const naam = document.getElementById('speler-naam').value;
        if(!naam) return alert("Naam invullen, agent!");
        document.getElementById('display-naam').innerText = naam;
        document.getElementById('start-screen').style.display = "none";
        gameActive = true;
        
        startTimer();
        spawnTarget();
    }

    function startTimer() {
        const t = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if(timeLeft <= 0) {
                clearInterval(t);
                gameActive = false;
                submitScore();
            }
        }, 1000);
    }

    function spawnTarget() {
        if(!gameActive) return;
        const opgave = data[Math.floor(Math.random() * data.length)];
        const div = document.createElement('div');
        div.className = 'target-sentence';
        div.innerHTML = opgave.pas;
        div.style.top = Math.random() * 70 + 15 + "%";
        div.style.left = "-500px";
        document.getElementById('game-container').appendChild(div);

        // Beweging
        let pos = -500;
        const move = setInterval(() => {
            if(!gameActive) { clearInterval(move); div.remove(); }
            pos += 3;
            div.style.left = pos + "px";
            if(pos > window.innerWidth) { clearInterval(move); div.remove(); spawnTarget(); }
        }, 20);

        // Hit detectie
        div.querySelector('.v-deelwoord').onclick = (e) => {
            e.stopPropagation();
            clearInterval(move);
            openHerschrijfMode(opgave, div);
        };
    }

    function openHerschrijfMode(opgave, element) {
        huidigeOpgave = opgave;
        document.getElementById('target-phrase').innerText = element.innerText;
        document.getElementById('input-overlay').style.display = "block";
        document.getElementById('active-input').focus();
        element.remove();
    }

    // Luister naar Enter in het invoerveld
    document.getElementById('active-input').onkeypress = (e) => {
        if(e.key === 'Enter') {
            const gok = document.getElementById('active-input').value.toLowerCase().trim();
            if(gok === huidigeOpgave.corr || gok.includes(huidigeOpgave.corr.split(' ')[1])) { // Iets soepeler op de actieve vorm
                score += 10;
                document.getElementById('score').innerText = score;
                document.getElementById('input-overlay').style.display = "none";
                document.getElementById('active-input').value = "";
                spawnTarget();
            } else {
                alert("FOUT! Dat is niet actief. Gebruik de ik-vorm in de verleden tijd.");
            }
        }
    };

    function submitScore() {
        const naam = document.getElementById('display-naam').innerText;
        db.ref('leaderboard').push({ naam, score });
        alert("MISSIE VOLTOOID! Je score: " + score);
        location.reload();
    }

    // Update Leaderboard
    db.ref('leaderboard').orderByChild('score').limitToLast(3).on('value', snap => {
        const list = document.getElementById('leader-list');
        list.innerHTML = "";
        let scores = [];
        snap.forEach(s => { scores.push(s.val()); });
        scores.reverse().forEach(s => {
            list.innerHTML += `<li>${s.naam}: ${s.score}</li>`;
        });
    });
</script>

</body>
</html>
